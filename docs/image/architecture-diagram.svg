<svg viewBox="0 0 1200 1400" xmlns="http://www.w3.org/2000/svg" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);">
  <!-- Define styles -->
  <defs>
    <style>
      .box { fill: white; stroke: #2c3e50; stroke-width: 2; }
      .title { font-size: 20px; font-weight: bold; fill: #2c3e50; }
      .label { font-size: 14px; fill: #2c3e50; font-family: Arial, sans-serif; }
      .small { font-size: 12px; fill: #555; font-family: Arial, sans-serif; }
      .arrow { stroke: #3498db; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .component { fill: #3498db; }
      .security { fill: #e74c3c; }
      .storage { fill: #2ecc71; }
      .config { fill: #f39c12; }
      .input { fill: #9b59b6; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#3498db" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="600" y="40" text-anchor="middle" class="title" style="font-size: 28px;">LakeTrace Logger Architecture</text>

  <!-- Input Layer -->
  <g id="input">
    <rect x="400" y="60" width="400" height="60" class="box" style="fill: #9b59b6;"/>
    <text x="600" y="82" text-anchor="middle" class="label" style="fill: white;">User Application / Spark Job</text>
    <text x="600" y="105" text-anchor="middle" class="small" style="fill: #ecf0f1;">logger.info("message", context=value)</text>
  </g>

  <!-- Arrow down -->
  <line x1="600" y1="120" x2="600" y2="150" class="arrow"/>

  <!-- Main Logger -->
  <g id="main-logger">
    <rect x="450" y="150" width="300" height="70" class="box" style="fill: #3498db;"/>
    <text x="600" y="175" text-anchor="middle" class="label" style="fill: white; font-size: 16px;">LakeTraceLogger</text>
    <text x="600" y="200" text-anchor="middle" class="small" style="fill: #ecf0f1;">get_logger(name, config)</text>
  </g>

  <!-- Arrow down to config/runtime/security -->
  <line x1="600" y1="220" x2="600" y2="250" class="arrow"/>

  <!-- Config, Runtime, Security Row -->
  <g id="config-runtime-security">
    <!-- Config -->
    <rect x="50" y="250" width="220" height="100" class="box" style="fill: #f39c12;"/>
    <text x="160" y="275" text-anchor="middle" class="label" style="fill: white;">Config Manager</text>
    <text x="160" y="295" text-anchor="middle" class="small" style="fill: #ecf0f1;">• log_dir</text>
    <text x="160" y="310" text-anchor="middle" class="small" style="fill: #ecf0f1;">• rotation</text>
    <text x="160" y="325" text-anchor="middle" class="small" style="fill: #ecf0f1;">• level, json</text>

    <!-- Runtime -->
    <rect x="340" y="250" width="220" height="100" class="box" style="fill: #3498db;"/>
    <text x="450" y="275" text-anchor="middle" class="label" style="fill: white;">Runtime Detection</text>
    <text x="450" y="295" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Fabric</text>
    <text x="450" y="310" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Databricks</text>
    <text x="450" y="325" text-anchor="middle" class="small" style="fill: #ecf0f1;">• PySpark</text>

    <!-- Security -->
    <rect x="630" y="250" width="220" height="100" class="box" style="fill: #e74c3c;"/>
    <text x="740" y="275" text-anchor="middle" class="label" style="fill: white;">Security Layer</text>
    <text x="740" y="295" text-anchor="middle" class="small" style="fill: #ecf0f1;">• PII Masking</text>
    <text x="740" y="310" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Whitelisting</text>
    <text x="740" y="325" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Leak Detection</text>

    <!-- Features -->
    <rect x="920" y="250" width="220" height="100" class="box" style="fill: #16a085;"/>
    <text x="1030" y="275" text-anchor="middle" class="label" style="fill: white;">Core Features</text>
    <text x="1030" y="295" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Formatting</text>
    <text x="1030" y="310" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Filtering</text>
    <text x="1030" y="325" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Context</text>
  </g>

  <!-- Arrows converging -->
  <line x1="160" y1="350" x2="300" y2="380" class="arrow"/>
  <line x1="450" y1="350" x2="450" y2="380" class="arrow"/>
  <line x1="740" y1="350" x2="600" y2="380" class="arrow"/>
  <line x1="1030" y1="350" x2="800" y2="380" class="arrow"/>

  <!-- Core Processing -->
  <g id="core-processing">
    <rect x="350" y="380" width="500" height="90" class="box" style="fill: #34495e;"/>
    <text x="600" y="410" text-anchor="middle" class="label" style="fill: white; font-size: 16px;">Core Message Processing</text>
    <text x="600" y="435" text-anchor="middle" class="small" style="fill: #bdc3c7;">Format → Add Metadata → Security Checks → Create Record</text>
  </g>

  <!-- Arrow down -->
  <line x1="600" y1="470" x2="600" y2="500" class="arrow"/>

  <!-- Handler Row -->
  <g id="handlers">
    <!-- File Handler -->
    <rect x="50" y="500" width="280" height="130" class="box" style="fill: #2ecc71;"/>
    <text x="190" y="525" text-anchor="middle" class="label" style="fill: white;">File Handler</text>
    <text x="190" y="545" text-anchor="middle" class="small" style="fill: #27ae60;">Rotation:</text>
    <text x="190" y="560" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Size-based</text>
    <text x="190" y="575" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Time-based</text>
    <text x="190" y="590" text-anchor="middle" class="small" style="fill: #27ae60;">Retention:</text>
    <text x="190" y="605" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Count/Time cleanup</text>

    <!-- Compression -->
    <rect x="410" y="500" width="280" height="130" class="box" style="fill: #2ecc71;"/>
    <text x="550" y="525" text-anchor="middle" class="label" style="fill: white;">Compression</text>
    <text x="550" y="560" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Gzip (gz)</text>
    <text x="550" y="575" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Bzip2 (bz2)</text>
    <text x="550" y="590" text-anchor="middle" class="small" style="fill: #ecf0f1;">• ZIP</text>
    <text x="550" y="605" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Optional</text>

    <!-- Output Sinks -->
    <rect x="770" y="500" width="380" height="130" class="box" style="fill: #2ecc71;"/>
    <text x="960" y="525" text-anchor="middle" class="label" style="fill: white;">Output Destinations</text>
    <text x="960" y="560" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Local Files (with rotation)</text>
    <text x="960" y="575" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Stdout (job logs)</text>
    <text x="960" y="590" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Async Queue (optional)</text>
    <text x="960" y="605" text-anchor="middle" class="small" style="fill: #ecf0f1;">• Lakehouse (end-of-run)</text>
  </g>

  <!-- Arrows down -->
  <line x1="190" y1="630" x2="190" y2="660" class="arrow"/>
  <line x1="550" y1="630" x2="550" y2="660" class="arrow"/>
  <line x1="960" y1="630" x2="960" y2="660" class="arrow"/>

  <!-- Storage Options -->
  <g id="storage">
    <!-- Local Files -->
    <rect x="50" y="660" width="280" height="90" class="box" style="fill: #27ae60;"/>
    <text x="190" y="690" text-anchor="middle" class="label" style="fill: white;">Local File System</text>
    <text x="190" y="710" text-anchor="middle" class="small" style="fill: #ecf0f1;">/tmp/laketrace_logs/</text>
    <text x="190" y="730" text-anchor="middle" class="small" style="fill: #ecf0f1;">Rotated & Compressed</text>

    <!-- Memory Queue -->
    <rect x="410" y="660" width="280" height="90" class="box" style="fill: #27ae60;"/>
    <text x="550" y="690" text-anchor="middle" class="label" style="fill: white;">Background Queue</text>
    <text x="550" y="710" text-anchor="middle" class="small" style="fill: #ecf0f1;">Async Writes (enqueue)</text>
    <text x="550" y="730" text-anchor="middle" class="small" style="fill: #ecf0f1;">High Throughput</text>

    <!-- Lakehouse -->
    <rect x="770" y="660" width="380" height="90" class="box" style="fill: #27ae60;"/>
    <text x="960" y="690" text-anchor="middle" class="label" style="fill: white;">Lakehouse (Optional)</text>
    <text x="960" y="710" text-anchor="middle" class="small" style="fill: #ecf0f1;">OneLake (Fabric) / Workspace (Databricks)</text>
    <text x="960" y="730" text-anchor="middle" class="small" style="fill: #ecf0f1;">Single write at end-of-run</text>
  </g>

  <!-- Horizontal divider -->
  <line x1="50" y1="800" x2="1150" y2="800" stroke="#95a5a6" stroke-width="2" stroke-dasharray="5,5"/>

  <!-- Key Features Section -->
  <text x="50" y="840" class="title" style="font-size: 18px;">Key Characteristics</text>

  <!-- Safety -->
  <g id="safety">
    <rect x="50" y="860" width="270" height="180" class="box" style="fill: #e8f4f8;"/>
    <text x="185" y="890" text-anchor="middle" class="label" style="color: #c0392b; font-weight: bold;">Spark Safety</text>
    <text x="65" y="915" class="small">✓ Driver-only logging</text>
    <text x="65" y="935" class="small">✓ No executor logging</text>
    <text x="65" y="955" class="small">✓ No distributed writes</text>
    <text x="65" y="975" class="small">✓ No remote append</text>
    <text x="65" y="995" class="small">✓ Thread-safe</text>
    <text x="65" y="1015" class="small">✓ Notebook re-run safe</text>
  </g>

  <!-- Performance -->
  <g id="performance">
    <rect x="380" y="860" width="270" height="180" class="box" style="fill: #f0f8e8;"/>
    <text x="515" y="890" text-anchor="middle" class="label" style="color: #27ae60; font-weight: bold;">Performance</text>
    <text x="395" y="915" class="small">✓ <20ms overhead/log</text>
    <text x="395" y="935" class="small">✓ Async I/O (enqueue)</text>
    <text x="395" y="955" class="small">✓ Local file writes</text>
    <text x="395" y="975" class="small">✓ Batch operations</text>
    <text x="395" y="995" class="small">✓ Memory efficient</text>
    <text x="395" y="1015" class="small">✓ Zero blocking I/O</text>
  </g>

  <!-- Security -->
  <g id="security-features">
    <rect x="710" y="860" width="270" height="180" class="box" style="fill: #ffe8e8;"/>
    <text x="845" y="890" text-anchor="middle" class="label" style="color: #c0392b; font-weight: bold;">Security</text>
    <text x="725" y="915" class="small">✓ PII masking</text>
    <text x="725" y="935" class="small">✓ Field whitelisting</text>
    <text x="725" y="955" class="small">✓ Data leak detection</text>
    <text x="725" y="975" class="small">✓ Log integrity (SHA256)</text>
    <text x="725" y="995" class="small">✓ Field encryption</text>
    <text x="725" y="1015" class="small">✓ 0o600 file permissions</text>
  </g>

  <!-- Compatibility -->
  <g id="compatibility">
    <rect x="1040" y="860" width="110" height="180" class="box" style="fill: #e8f0f8;"/>
    <text x="1095" y="890" text-anchor="middle" class="label" style="font-size: 13px; color: #2980b9; font-weight: bold;">Platforms</text>
    <text x="1055" y="920" class="small">✓ Fabric</text>
    <text x="1055" y="940" class="small">✓ Databricks</text>
    <text x="1055" y="960" class="small">✓ Spark</text>
    <text x="1055" y="980" class="small">✓ Local</text>
    <text x="1055" y="1015" class="small" style="font-size: 11px;">Cross-Platform</text>
  </g>

  <!-- Data Flow Explanation -->
  <text x="50" y="1090" class="title" style="font-size: 18px;">Data Flow Path</text>

  <!-- Flow boxes -->
  <g id="flow">
    <rect x="50" y="1110" width="150" height="50" class="box" style="fill: #9b59b6;"/>
    <text x="125" y="1138" text-anchor="middle" class="small" style="fill: white; font-weight: bold;">App Code</text>

    <line x1="200" y1="1135" x2="240" y2="1135" class="arrow" marker-end="url(#arrowhead)"/>

    <rect x="240" y="1110" width="150" height="50" class="box" style="fill: #f39c12;"/>
    <text x="315" y="1138" text-anchor="middle" class="small" style="fill: white; font-weight: bold;">Config</text>

    <line x1="390" y1="1135" x2="430" y2="1135" class="arrow" marker-end="url(#arrowhead)"/>

    <rect x="430" y="1110" width="150" height="50" class="box" style="fill: #e74c3c;"/>
    <text x="505" y="1138" text-anchor="middle" class="small" style="fill: white; font-weight: bold;">Security</text>

    <line x1="580" y1="1135" x2="620" y2="1135" class="arrow" marker-end="url(#arrowhead)"/>

    <rect x="620" y="1110" width="150" height="50" class="box" style="fill: #3498db;"/>
    <text x="695" y="1138" text-anchor="middle" class="small" style="fill: white; font-weight: bold;">Format</text>

    <line x1="770" y1="1135" x2="810" y2="1135" class="arrow" marker-end="url(#arrowhead)"/>

    <rect x="810" y="1110" width="150" height="50" class="box" style="fill: #2ecc71;"/>
    <text x="885" y="1138" text-anchor="middle" class="small" style="fill: white; font-weight: bold;">Storage</text>

    <line x1="960" y1="1135" x2="1000" y2="1135" class="arrow" marker-end="url(#arrowhead)"/>

    <rect x="1000" y="1110" width="150" height="50" class="box" style="fill: #16a085;"/>
    <text x="1075" y="1138" text-anchor="middle" class="small" style="fill: white; font-weight: bold;">Output</text>
  </g>

  <!-- Footer -->
  <text x="600" y="1320" text-anchor="middle" class="small" style="fill: #555; font-style: italic;">LakeTrace: Production-Grade Logging for Spark Data Platforms</text>
  <text x="600" y="1345" text-anchor="middle" class="small" style="fill: #7f8c8d;">Driver-safe • No remote append • Structured JSON • Security-first</text>
</svg>
